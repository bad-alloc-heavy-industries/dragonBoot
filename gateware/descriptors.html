<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>USB Descriptors &mdash; dragonBoot  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx_construct.css" type="text/css" />
      <link rel="stylesheet" href="../_static/platformpicker.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/platformpicker.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="The SPI Flash controller" href="flash.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> dragonBoot
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../gettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../firmware/index.html">dragonBoot for microcontroller</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">dragonBoot for FPGA</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="platforms/index.html">Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="handlers/index.html">Request Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="luna.html">The LUNA-based USB Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="flash.html">The SPI Flash controller</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">USB Descriptors</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">dragonBoot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">dragonBoot for FPGA</a> &raquo;</li>
      <li>USB Descriptors</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="usb-descriptors">
<h1>USB Descriptors<a class="headerlink" href="#usb-descriptors" title="Permalink to this headline"></a></h1>
<div class="toctree-wrapper compound">
</div>
<p>The descriptors for dragonBoot gateware work as follows:</p>
<ul class="simple">
<li><p>The device descriptor defines the class, subclass and protocol to be in the interfaces.</p></li>
<li><p>It also defines the device to be USB 2.01 compliant to allow us to use Binary Object Storage (BOS) descriptors.</p>
<ul>
<li><p>It is of particular note that even USB FS devices may be USB 2.01 compliant as physical protocol compliance is
seperate from logical protocol compliance, and a device on an older physical protocol may choose to implement
any newer logical protocol defined by the spec with the exception of USB 3.x support which requires USB HS as
fallback.</p></li>
</ul>
</li>
<li><p>We define a single configuration which supports up to 100mA max draw with power required from the bus and no
wake-up support - this keeps the implmentation simple as we have no need for wakeup support.</p></li>
<li><p>In the configuration we then define one interface which is coded as being for DFU and already in DFU mode.</p></li>
<li><p>This interface descriptor is then repeated for each slot with a unique alternate setting number per slot.</p></li>
<li><p>The interface descriptors each sport a DFU functional descriptor that further defines:</p>
<ul>
<li><p>That we can download, not upload, cannot be “manifested” (switched to application mode) in the way the
standard defines and we control detaching from the bus when a <code class="docutils literal notranslate"><span class="pre">DFU_DETACH</span></code> request is received.</p></li>
<li><p>That we have the minimum viable timeout for detach to keep delays caused by tooling down as best as possible.</p></li>
<li><p>That sets the transfer size to equal the target Flash’s erase page size</p></li>
</ul>
</li>
<li><p>We then define platform-specific Windows descriptors that ask Windows to bind WinUSB.sys to the DFU interface.</p>
<ul>
<li><p>This is done to avoid the need for custom INF files and other drudgery so we get a “just works” solution out
the box on all host platforms where this matters. Windows is the exception, not the rule.</p></li>
</ul>
</li>
</ul>
<p>The string descriptors are automatically generated from the strings assigned to their respective slots in the
various descriptors - this is done by
<a class="reference external" href="https://github.com/shrine-maiden-heavy-industries/python-usb-protocol">python-usb-protocol</a>.</p>
<p>We manually define the string dscriptors to be in American as part of the setup of the LUNA core. This is not
strictly required, but means that if any behaviour is required to change in the future, we will be immune.</p>
<p>The standard USB descriptors are handed off to the
<code class="xref py py-class docutils literal notranslate"><span class="pre">LUNA</span> <span class="pre">standard</span> <span class="pre">descriptor</span> <span class="pre">handler</span></code> during
setup of the LUNA core, and the Windows ones to our <a class="reference internal" href="handlers/windows.html#dragonBoot.windows.WindowsRequestHandler" title="dragonBoot.windows.WindowsRequestHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">dragonBoot.windows.WindowsRequestHandler</span></code></a>.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="flash.html" class="btn btn-neutral float-left" title="The SPI Flash controller" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022-2022, Rachel Mant.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>